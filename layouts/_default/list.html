{{ define "main" }}

{{- /* Look up this section's config from params.sections */ -}}
{{- $sectionName := .Section -}}
{{- $sectionCfg := dict -}}
{{- range .Site.Params.sections -}}
	{{- if eq .name $sectionName -}}
		{{- $sectionCfg = . -}}
	{{- end -}}
{{- end -}}

{{- $listDisplay := $sectionCfg.list_display | default $sectionCfg.display | default "list" -}}
{{- $tagsKey := $sectionCfg.tags -}}
{{- $show := $sectionCfg.list_show | default $sectionCfg.show -}}

<div class="page-wrapper page-wrapper--narrow">

    <!-- Title and summary -->
    <div class="pt-5 pb-3">
        <h1 class="display-2 mb-4">{{ .Title }} <span class="section-count">({{ len .RegularPages }})</span></h1>
        <p class="bio fs-4 body-text">{{ .Summary }}</p>
    </div>

    {{- /* Filter Buttons â€” only shown when a tags taxonomy is configured */ -}}
    {{ if $tagsKey }}
    {{ $taxonomy := index .Site.Taxonomies $tagsKey }}
    {{ if $taxonomy }}
    <div class="mb-4">
        <div class="btn-toolbar mb-2 bio" role="toolbar" aria-label="Toolbar with button groups">
            <div id="filters" class="button-group">
                <i class="fas fa-filter"></i>
                {{ range $name, $_ := $taxonomy }}
                {{ $btnid := $name | printf ".js-iso-%s"}}
                <input type="checkbox" class="btn-check" id="{{ $btnid }}" autocomplete="off" data-filter="{{ $btnid }}">
                <label class="button" for="{{ $btnid }}">{{ $name }}</label>
                {{ end }}
            </div>
        </div>
    </div>
    {{ end }}
    {{ end }}

    {{- /* Render pages using the configured display mode */ -}}
    {{- $pages := .Pages.ByPublishDate.Reverse -}}

    {{ if eq $listDisplay "list" }}
        {{ partial "display_list.html" (dict "pages" $pages "tags_key" $tagsKey "id" "blogposts" "show" $show) }}
    {{ else if eq $listDisplay "grid" }}
        {{ partial "display_grid.html" (dict "pages" $pages "tags_key" $tagsKey "id" "blogposts" "show" $show) }}
    {{ else if eq $listDisplay "full" }}
        {{ partial "display_full.html" (dict "pages" $pages "tags_key" $tagsKey "id" "blogposts" "show" $show) }}
    {{ end }}

</div>

{{ end }}